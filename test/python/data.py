import os
import os.path as osp
import random
import tempfile

import numpy as np

import motion3d as m3d


OUTPUT_DIR = tempfile.TemporaryDirectory(prefix='motion3d_')


def get_data_file(*args):
    """Return absolute path of a file in the data directory."""
    current_dir = osp.dirname(osp.abspath(__file__))
    data_file = osp.join(current_dir, osp.pardir, 'data', *args)
    return osp.abspath(data_file)


def get_output_file(prefix, suffix=None):
    """Return absolute path of an output file in the temp directory."""
    if suffix is None:
        filename = prefix
    else:
        filename = prefix + str(random.randint(100000, 999999)) + suffix
    return osp.join(OUTPUT_DIR.name, filename)


TRANSFORM_CLASSES = {
    m3d.TransformType.kAxisAngle: m3d.AxisAngleTransform,
    m3d.TransformType.kDualQuaternion: m3d.DualQuaternionTransform,
    m3d.TransformType.kEuler: m3d.EulerTransform,
    m3d.TransformType.kMatrix: m3d.MatrixTransform,
    m3d.TransformType.kQuaternion: m3d.QuaternionTransform
}

TRANSFORM_ARRAYS = {
    m3d.TransformType.kAxisAngle: np.array([0, 0, 0, 0, 0, 0, 1]),
    m3d.TransformType.kDualQuaternion: np.array([1, 0, 0, 0, 0, 0, 0, 0]),
    m3d.TransformType.kEuler: np.array([0, 0, 0, 0, 0, 0, 0]),
    m3d.TransformType.kMatrix: np.array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0]),
    m3d.TransformType.kQuaternion: np.array([0, 0, 0, 1, 0, 0, 0])
}


# generated using data/generate_data.py
TRANSFORM_ARRAYS_UNIT = {
    m3d.AxisAngleTransform: [0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,0.0000000000000000],
    m3d.DualQuaternionTransform: [1.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000],
    m3d.EulerTransform: [0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000],
    m3d.MatrixTransform: [1.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000],
    m3d.QuaternionTransform: [0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000],
}
ROTATION_NORM_UNIT = 0.0
TRANSLATION_NORM_UNIT = 0.0

TRANSFORM_ARRAYS1 = {
    m3d.AxisAngleTransform: [ 0.4881350392732475, 2.1518936637241950, 1.0276337607164390, 1.1183228242470875, 0.4269553197484234,-0.2837410197015896, 0.8586036272210966],
    m3d.DualQuaternionTransform: [ 0.8477002593594949, 0.2264893424282615,-0.1505176630894401, 0.4554681999287689,-0.1273569388799999, 0.7742941825119116, 0.9172894619574282, 0.1551357396149909],
    m3d.EulerTransform: [ 0.4881350392732475, 2.1518936637241950, 1.0276337607164390, 0.2820093559455552,-0.4796910430674712, 0.9166797476244106, 0.0000000000000000],
    m3d.MatrixTransform: [ 0.5397863039034816,-0.8403823154931709,-0.0488703378805054, 0.4881350392732475, 0.7040197293453072, 0.4825025932401216,-0.5211021667668617, 2.1518936637241950, 0.4615051102759085, 0.2468781305075329, 0.8520940217290149, 1.0276337607164390],
    m3d.QuaternionTransform: [ 0.4881350392732475, 2.1518936637241950, 1.0276337607164390, 0.8477002593594949, 0.2264893424282615,-0.1505176630894401, 0.4554681999287689],
}
ROTATION_NORM1 = 1.1183228242470875
TRANSLATION_NORM1 = 2.434122696723985

TRANSFORM_ARRAYS2 = {
    m3d.AxisAngleTransform: [-0.6241278873730751, 3.9177300078207971, 4.6366276050102933,-2.0003093274349464, 0.3376823556437861,-0.8532486349525659,-0.3974133787864299],
    m3d.DualQuaternionTransform: [ 0.5401721543757527,-0.2841781194383126, 0.7180552624132633, 0.3344450331372585,-2.2706036055777803,-1.1781130074340447, 0.5036785086169386, 1.5848759772894736],
    m3d.EulerTransform: [-0.6241278873730751, 3.9177300078207971, 4.6366276050102933, 2.4092341172487508, 1.3086301805723899,-2.9600405183462106, 0.0000000000000000],
    m3d.MatrixTransform: [-0.2549136801391241,-0.7694269763908163, 0.5856629949723771,-0.6241278873730751,-0.0467954001107248, 0.6147786324846444, 0.7873102460712598, 3.9177300078207971,-0.9658308372620982, 0.1732898180574864,-0.1927211268937522, 4.6366276050102933],
    m3d.QuaternionTransform: [-0.6241278873730751, 3.9177300078207971, 4.6366276050102933, 0.5401721543757527,-0.2841781194383126, 0.7180552624132633, 0.3344450331372585],
}
ROTATION_NORM2 = 2.0003093274349464
TRANSLATION_NORM2 = 6.102168432739284

TRANSFORM_ARRAYS12 = {
    m3d.AxisAngleTransform: [-3.3677452193474049, 1.1866535143052119, 5.6576400746051103,-2.1447983001439717, 0.5646336042417706,-0.3668331506244453,-0.7393391187837219],
    m3d.DualQuaternionTransform: [ 0.4780183136165607,-0.4959458521499688, 0.3222078496861799, 0.6493984179092440,-2.8633154316742795,-1.3310845091916512,-0.0258162994184388, 1.1039287552271106],
    m3d.EulerTransform: [-3.3677452193474049, 1.1866535143052119, 5.6576400746051103,-0.1831844985162312, 1.2602782863420856, 1.7387326238852072, 0.0000000000000000],
    m3d.MatrixTransform: [-0.0510724071648416,-0.9404439663525214,-0.3360903976276712,-3.3677452193474049, 0.3012533800244354,-0.3353611868955754, 0.8926249354280016, 1.1866535143052119,-0.9521754093916949,-0.0556598641314230, 0.3004396266716989, 5.6576400746051103],
    m3d.QuaternionTransform: [-3.3677452193474049, 1.1866535143052119, 5.6576400746051103, 0.4780183136165607,-0.4959458521499688, 0.3222078496861799, 0.6493984179092440],
}
ROTATION_NORM12 = 2.1447983001439717
TRANSLATION_NORM12 = 6.690197727962001

TRANSFORM_ARRAYS1_INV = {
    m3d.AxisAngleTransform: [-2.2527224354327635,-0.8817745202382083, 0.2695711910857732,-1.1183228242470875, 0.4269553197484233,-0.2837410197015894, 0.8586036272210966],
    m3d.DualQuaternionTransform: [ 0.8477002593594948,-0.2264893424282614, 0.1505176630894403,-0.4554681999287690,-0.1273569388799997,-0.7742941825119116,-0.9172894619574283,-0.1551357396149908],
    m3d.EulerTransform: [-2.2527224354327635,-0.8817745202382083, 0.2695711910857732,-0.5488723650466376, 0.0488898117359242,-0.9998458058979547, 0.0000000000000000],
    m3d.MatrixTransform: [ 0.5397863039034817, 0.7040197293453073, 0.4615051102759086,-2.2527224354327635,-0.8403823154931709, 0.4825025932401215, 0.2468781305075329,-0.8817745202382083,-0.0488703378805054,-0.5211021667668617, 0.8520940217290150, 0.2695711910857732],
    m3d.QuaternionTransform: [-2.2527224354327635,-0.8817745202382083, 0.2695711910857732, 0.8477002593594948,-0.2264893424282614, 0.1505176630894403,-0.4554681999287690],
}
ROTATION_NORM1_INV = 1.1183228242470875
TRANSLATION_NORM1_INV = 2.4341226967239855

POINT_0 = [0.5680445610939323,0.9255966382926610,0.0710360581978869]
POINT_1 = [0.0134311110917052,2.9613939763066712,1.5788281967090874]